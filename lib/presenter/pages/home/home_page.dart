import 'package:flutter/cupertino.dart';import 'package:flutter/material.dart';import 'package:flutter_bloc/flutter_bloc.dart';import 'package:flutter_svg/flutter_svg.dart';import 'package:google_fonts/google_fonts.dart';import 'package:lottie/lottie.dart';import '../../../utils/category.dart';import '../../../utils/category_holder.dart';import '../../../utils/product_holder.dart';import '../../../utils/slider.dart';import '../../../utils/top_product_item.dart';import '../dashboard/dashboard_page.dart';import '../products/products_page.dart';import 'bloc/home_bloc.dart';class HomePage extends StatefulWidget {  const HomePage({super.key});  @override  State<HomePage> createState() => _HomePageState();}class _HomePageState extends State<HomePage> {  final _bloc = HomeBloc();  List<CategoryHolder> categoryHolder = [];  List<String> sliderData = [];  List<ProductHolder> topProducts = [];  @override  void initState() {    _bloc.add(GetSlidersEvent());    _bloc.add(GetTopProductsEvent());    _bloc.add(GetTopCategoriesEvent());    super.initState();  }  @override  void dispose() {    _bloc.close();    super.dispose();  }  @override  Widget build(BuildContext context) {    return BlocProvider.value(      value: _bloc,      child: BlocConsumer<HomeBloc, HomeState>(        listener: (context, state) {          if (state is ClickTopCategoryState) {            Navigator.push(                context,                MaterialPageRoute(                    builder: (context) =>                        ProductsPage(state.title, state.slug)));          }          if (state is GetTopCategoriesState) {            state.data.data?.data?.forEach((element) {              categoryHolder.add(CategoryHolder(element.image ?? '',                  element.title ?? '', element.slug ?? '', []));            });          }          if (state is GetSliderState) {            state.data.data?.data?.forEach((element) {              sliderData.add(element.imageMobileWeb ?? '');            });          }          if (state is GetTopProductsState) {            state.data.data?.data?.forEach((element) {              topProducts.add(ProductHolder(                  element.id,                  element.name,                  element.image,                  element.saleMonths,                  element.stickers,                  element.availability,                  0,                  '',                  [],                  element.salePrice,                  '',                  element.oldPrice,                  '',                  0,                  '',                  element.axiomMonthlyPrice,                  element.reviewsCount,                  element.reviewsAverage,                  element.allCount,                  null,                  false,                  0));            });          }        },        builder: (context, state) {          if (state is LoadingState) {            return const Scaffold(              body: SafeArea(                child: Center(                  child: CupertinoActivityIndicator(),                ),              ),            );          } else {            return Scaffold(              appBar: AppBar(                automaticallyImplyLeading: false,                backgroundColor: const Color(0xFFfbc100),                centerTitle: true,                title: SizedBox(                  width: 100,                  height: 100,                  child: SvgPicture.asset(                    'assets/icons/logo_tm.svg',                    width: 100,                    height: 100,                    fit: BoxFit.contain,                  ),                ),              ),              body: SafeArea(                child: (categoryHolder.isEmpty &&                        sliderData.isEmpty &&                        topProducts.isEmpty)                    ? Center(                        child: Lottie.asset('assets/lottie/loading_circle.json',                            height: 150, width: 150, fit: BoxFit.fitWidth),                      )                    : CustomScrollView(                        slivers: [                          if (sliderData.isEmpty)                            SliverToBoxAdapter(                              child: Padding(                                  padding: const EdgeInsets.only(top: 15),                                  child: SizedBox(                                    height: 240,                                    child: Center(                                      child: Lottie.asset(                                          'assets/lottie/loading_circle.json',                                          height: 150,                                          width: 150,                                          fit: BoxFit.fitWidth),                                    ),                                  )),                            ),                          if (sliderData.isNotEmpty)                            SliverToBoxAdapter(                              child: Padding(                                  padding: const EdgeInsets.only(top: 15),                                  child: SizedBox(                                    height: 240,                                    child: ImageSliderDemo(imgList: sliderData),                                  )),                            ),                          SliverToBoxAdapter(                            child: Column(                              crossAxisAlignment: CrossAxisAlignment.start,                              children: [                                Padding(                                  padding: const EdgeInsets.symmetric(                                      horizontal: 24, vertical: 10),                                  child: Row(                                    children: [                                      Text('Kategoriyalar',                                          textAlign: TextAlign.start,                                          style: GoogleFonts.poppins(                                              fontWeight: FontWeight.w500,                                              fontSize: 14)),                                      const Spacer(),                                      InkWell(                                          borderRadius:                                              BorderRadius.circular(5),                                          highlightColor:                                              const Color(0xFFfbc100)                                                  .withAlpha(60),                                          splashColor: const Color(0xFFfbc100)                                              .withAlpha(60),                                          onTap: () {                                            Navigator.pushAndRemoveUntil(                                                context,                                                MaterialPageRoute(                                                    builder: (context) =>                                                        const DashboardPage(1)),                                                (route) => false);                                          },                                          child: Row(                                            children: [                                              Text('barchasi',                                                  textAlign: TextAlign.start,                                                  style: GoogleFonts.poppins(                                                      fontWeight:                                                          FontWeight.w400,                                                      color: Colors.grey,                                                      fontSize: 12)),                                              const SizedBox(width: 5),                                              const Icon(                                                Icons.arrow_forward_ios_rounded,                                                size: 12,                                              )                                            ],                                          )),                                    ],                                  ),                                ),                                SizedBox(                                    height: 120,                                    child: ListView.builder(                                      scrollDirection: Axis.horizontal,                                      itemCount: categoryHolder.length,                                      itemBuilder: (context, index) {                                        return Padding(                                          padding: const EdgeInsets.symmetric(                                              horizontal: 8.0),                                          child: categoryItem(                                              CategoryHolder(                                                  categoryHolder[index].image,                                                  categoryHolder[index].name,                                                  categoryHolder[index].slug,                                                  []), () {                                            _bloc.add(ClickTopCategoryEvent(                                                categoryHolder[index].name,                                                categoryHolder[index].slug));                                          }),                                        );                                      },                                    )),                                const Divider(color: Color(0x15000000)),                                Padding(                                  padding: const EdgeInsets.symmetric(                                      horizontal: 24, vertical: 10),                                  child: Text('Xit tovarlar',                                      textAlign: TextAlign.start,                                      style: GoogleFonts.poppins(                                          fontWeight: FontWeight.w500,                                          fontSize: 14)),                                ),                              ],                            ),                          ),                          SliverGrid(                            gridDelegate:                                const SliverGridDelegateWithFixedCrossAxisCount(                              crossAxisCount: 2,                              mainAxisSpacing: 8.0,                              crossAxisSpacing: 8.0,                            ),                            delegate: SliverChildBuilderDelegate(                              (BuildContext context, int index) {                                return topProductItem(topProducts[index], () {                                  Navigator.push(                                      context,                                      MaterialPageRoute(                                          builder: (context) => DashboardPage(                                                5,                                                item: topProducts[index],                                              )));                                });                              },                              childCount: topProducts.length,                            ),                          ),                        ],                      ),              ),            );          }        },      ),    );  }}